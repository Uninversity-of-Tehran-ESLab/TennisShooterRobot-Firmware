<html>

<head>
  <title>Tennis Robot Contol</title>
  <link href="bootstrap.min.css" rel="stylesheet">
  <script src="jquery.min.js"></script>
</head>


<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header">
            Status
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col">
                <div class="row">
                  <div class="col">
                    <div class="card">
                      <div class="card-header">
                        Left Motor
                      </div>
                      <ul class="list-group list-group-flush">

                        <li class="list-group-item">RPM L : <p id="rpmLNum">0</p>
                        </li>
                        <li class="list-group-item">PWM L : <p id="pwmLNum">0</p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col">
                    <div class="card">
                      <div class="card-header">
                        Speed Meter
                      </div>
                      <ul class="list-group list-group-flush">

                        <li class="list-group-item">Δt : <p id="deltaTNum">0</p>
                        </li>
                        <li class="list-group-item">Speed(m/s) : <p id="speedNum">0</p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

              </div>

              <div class="col">

              </div>

              <div class="col">
                <div class="row">
                  <div class="col">
                    <div class="card">
                      <div class="card-header">
                        Right Motor
                      </div>
                      <ul class="list-group list-group-flush">

                        <li class="list-group-item">RPM R : <p id="rpmRNum">0</p>
                        </li>
                        <li class="list-group-item">PWM R : <p id="pwmRNum">0</p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col">
                    <div class="card">
                      <div class="card-header">
                        Angles
                      </div>
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item">θ : <p id="thetaNum">0</p>
                        </li>
                        <li class="list-group-item">Φ : <p id="phiNum">0</p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="row">
        <div class="col">

          <div class="card">
            <div class="card-header">
              Shooting
            </div>
            <div class="card-body">
              <form>

                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="RPMLInput">RPM L:</label>
                      <input type="number" class="form-control" id="RPMLInput" aria-describedby="RPMLHelp"
                        placeholder="Enter RPM for the Left Motor" min="0" max="3500">
                      <small id="RPMLHelp" class="form-text text-muted">Should be between 0 and 3500</small>
                    </div>
                  </div>

                  <div class="col">
                    <div class="form-group">
                      <label for="RPMRInput">RPM R:</label>
                      <input type="number" class="form-control" id="RPMRInput" aria-describedby="RPMRHelp"
                        placeholder="Enter RPM for the Right Motor" min="0" max="3500">
                      <small id="RPMRHelp" class="form-text text-muted">Should be between 0 and 3500</small>
                    </div>
                  </div>

                </div>

                <div class="row">

                  <div class="col">
                    <div class="form-group">
                      <label for="thetaInput">Horizontal Angle(θ):</label>
                      <input type="number" class="form-control" id="thetaInput" aria-describedby="thetaHelp"
                        placeholder="Enter Horizontal Angle" min="-30" max="30">
                      <small id="thetaHelp" class="form-text text-muted">Should be between -30 and 30</small>
                    </div>
                  </div>

                  <div class="col">
                    <div class="form-group">
                      <label for="phiInput">Vertical Angle(Φ):</label>
                      <input type="number" class="form-control" id="phiInput" aria-describedby="phiHelp"
                        placeholder="Enter Vertical Angle" min="10" max="50">
                      <small id="phiHelp" class="form-text text-muted">Should be between 10 and 50</small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="d-grid gap-2  d-md-flex ">
                    <button type="button" id="setBtn" class="btn btn-primary btn-lg btn-warning">Set</button>

                    <button type="button" id="shootBtn" class="btn btn-primary btn-lg btn-danger">Fire</button>
                    <button type="button" id="setShootBtn" class="btn btn-primary btn-lg btn-danger">Set &
                      Shoot</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-header">
              RPM Calibration
            </div>
            <div class="card-body">
              <form>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="minPWMInput-addon">Min PWM:</span>
                  <input type="number" id="minPWMInput" class="form-control" placeholder="Between 0 and 65535"
                    aria-label="Min PWM" min="0" max="65535" aria-describedby="minPWMInput-addon">
                </div>
                <div class="input-group mb-3">
                  <span class="input-group-text" id="maxPWMInput-addon">Max PWM:</span>
                  <input type="number" id="maxPWMInput" class="form-control" placeholder="Between 0 and 65535"
                    aria-label="Max PWM" min="0" max="65535" aria-describedby="maxPWMInput-addon">
                </div>
                <div class="input-group mb-3">
                  <button type="button" id="calRPMBtn" class="btn btn-primary btn-lg btn-danger">Calibrate RPM</button>

                </div>

              </form>
            </div>
          </div>
        </div>




        <div class="col">
          <div class="card">
            <div class="card-header">
              Vertical Angle Calibration
            </div>
            <div class="card-body">
              <div class="input-group mb-3">
                <button type="button" id="calPhiBtn" class="btn btn-primary btn-lg btn-primary">Calibrate Vertical
                  Angle</button>

              </div>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card">
            <div class="card-header">
              Loading Calibration
            </div>
            <div class="card-body">
              <div class="input-group mb-3">
                <button type="button" id="calLoadBtn" class="btn btn-primary btn-lg btn-primary">Calibrate Loading
                  System</button>

              </div>
            </div>
          </div>
        </div>


      </div>

    </div>
  </div>

  <script>
  
    $(document).ready(function () {
      $("#setBtn").click(function () {
        var rpml = $("#RPMLInput").val();
        var rpmr = $("#RPMRInput").val();
        var theta = $("#thetaInput").val();
        var phi = $("#phiInput").val();
        console.log("Datwodkawopdk");
        $.ajax({
          url: "/setParams",
          type: "POST",
          data: JSON.stringify(
           {
            pwml: rpml,
            pwmr: rpmr,
            theta: theta,
            phiTicks: phi
          }),
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          success: function (data, status) {
            console.log("Data: " + data + "\nStatus: " + status);
            updateStat();
          }
        });
      });
      
      $("#shootBtn").click(function () {
        
        console.log("Datwodkawopdk");
        $.ajax({
          url: "/shoot",
          type: "POST",
          data: JSON.stringify(
           {
         
          }),
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          success: function (data, status) {
            console.log("Data: " + data + "\nStatus: " + status);
            updateStat();
          }
        });
      });

    });



    function updateStat() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          const resp = JSON.parse(this.responseText);
          //{"pwml":PWML,"rpml":RPML,"pwmr":PWMR,"rpmr":RPMR,"theta":currentTheta,"phiTicks":currentPhiTicks,"ballSpeed":ballSpeed,"ballDT":ballDT}
          document.getElementById("rpmRNum").innerText = resp["rpmr"];
          document.getElementById("rpmLNum").innerText = resp["rpml"];
          document.getElementById("pwmRNum").innerText = resp["pwmr"];
          document.getElementById("pwmLNum").innerText = resp["pwml"];
          document.getElementById("phiNum").innerText = resp["phiTicks"];
          document.getElementById("thetaNum").innerText = resp["theta"];
          document.getElementById("speedNum").innerText = resp["ballSpeed"];
          document.getElementById("deltaTNum").innerText = resp["ballDT"];
        }
      };
      xhttp.open("GET", "/getStats", true);
      xhttp.send();
    }
    setInterval(updateStat, 5000);
  </script>
</body>

</html>